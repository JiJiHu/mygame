# 游戏网站运维计划

## 服务器信息

**服务器：** 阿里云ECS
**操作系统：** Linux 6.8.0-90-generic (x64)
**Node版本：** v22.22.0
**运行目录：** /root/myopencode/games

---

## 服务概览

**服务名称：** 游戏网站 + 排行榜API（合并服务器）
**技术栈：** Node.js + Express
**运行端口：** 8080
**进程管理：** 手动启动/停止脚本

**访问地址：**
- 外网：http://150.40.177.181:8080
- 内网：http://172.31.3.233:8080

**数据文件：**
- 排行榜数据：/root/myopencode/games/leaderboard-data.json
- 服务器日志：/tmp/game-server.log

---

## 我可以提供的运维服务

### 1. 服务监控 ✅

**自动健康检查：**
- 每小时检查服务器运行状态
- 检查 API 端点响应 (`/api/health`)
- 检查端口 8080 监听状态
- 检查进程运行状态

**监控指标：**
- CPU/内存使用率
- 磁盘空间（警告阈 < 10%）
- 排行榜数据文件大小
- 日志文件大小（自动归档 > 100MB）

**告警机制：**
- 服务停止时立即通知（WhatsApp）
- API响应异常时通知
- 磁盘空间不足时通知
- 数据文件丢失时通知

---

### 2. 日志管理 ✅

**日志文件位置：** `/tmp/game-server.log`

**日志管理策略：**
- 每天自动归档日志（rotate）
- 保留最近7天的日志
- 删除超过7天的旧日志
- 压缩归档的日志文件

**日志分析：**
- 统计每天的请求数量
- 分析错误日志
- 识别异常请求模式
- 性能瓶颈分析

---

### 3. 数据备份 ✅

**备份内容：**
- 排行榜数据文件（`leaderboard-data.json`）
- 服务器配置文件
- 游戏代码文件

**备份策略：**
- 每天凌晨3:00自动备份
- 保留最近7天的备份
- 备份文件命名：`leaderboard-data.json.backup.YYYYMMDD`

**备份目录：** `/root/myopencode/games/backups/`

**恢复流程：**
```bash
cd ~/myopencode/games
cp backups/leaderboard-data.json.backup.20260209 leaderboard-data.json
./stop-server.sh && ./start-server.sh
```

---

### 4. 自动重启 ✅

**触发条件：**
- 服务进程意外停止
- API健康检查失败3次
- 服务器无响应超过60秒

**重启策略：**
- 立即尝试重启
- 如果失败，等待1分钟后重试
- 重试3次仍失败，发送告警通知
- 记录重启日志便于分析

**重启脚本：** 监控进程可自动调用 `start-server.sh`

---

### 5. 安全维护 ✅

**定期安全检查：**
- 每周检查系统更新
- 检查Node.js依赖包安全漏洞
- 监控异常访问日志
- 检查API调用频率（防刷）

**安全措施：**
- API请求频率限制（Rate Limiting）
- CORS配置验证
- 数据输入验证和清理
- 敏感日志脱敏处理

---

### 6. 性能优化 ✅

**定期优化项：**
- 每月检查排行榜数据，清理过期记录
- 定期清理日志文件
- 监控内存泄漏
- 优化数据库查询（如果升级到数据库）

**性能指标：**
- API响应时间 < 200ms
- 页面加载时间 < 2s
- 服务器运行时间 > 99.9%

---

### 7. 更新和维护 ✅

**更新类型：**
- 安全补丁更新
- 功能改进更新
- Bug修复更新

**更新流程：**
1. 备份数据
2. 在测试环境验证
3. 通知维护窗口
4. 执行更新
5. 验证服务正常
6. 通知更新完成

**回滚机制：**
- 保留更新前备份
- 快速回滚脚本
- 最小化服务中断时间

---

### 8. 故障处理 ✅

**故障等级：**

| 等级 | 描述 | 响应时间 |
|------|------|----------|
| P0 | 服务完全停止 | 立即 |
| P1 | API无响应 | 5分钟内 |
| P2 | 性能严重下降 | 15分钟内 |
| P3 | 轻微问题 | 24小时内 |

**故障处理流程：**
1. 发现故障（自动或手动）
2. 诊断问题根因
3. 立即通知（WhatsApp）
4. 实施修复措施
5. 验证恢复
6. 总结复盘
7. 更新故障日志

---

### 9. 监控报告 ✅

**报告频率：**
- 每日：服务状态摘要
- 每周：性能和问题统计
- 每月：全面运维报告

**报告内容：**
- 服务可用性
- API请求统计
- 排行榜数据量
- 错误日志摘要
- 性能指标
- 资源使用情况

---

## 自动化运维脚本

### 1. 健康检查脚本
```bash
#!/bin/bash
# 健康检查脚本
curl http://localhost:8080/api/health || ./start-server.sh
```

### 2. 备份脚本
```bash
#!/bin/bash
# 每日备份脚本
DATE=$(date +%Y%m%d)
cp leaderboard-data.json backups/leaderboard-data.json.backup.$DATE
```

### 3. 日志归档脚本
```bash
#!/bin/bash
# 日志归档脚本
DATE=$(date +%Y%m%d)
mv /tmp/game-server.log /tmp/game-server.log.$DATE
gzip /tmp/game-server.log.$DATE
```

---

## 定期维护计划

| 任务 | 频率 | 状态 |
|------|------|------|
| 健康检查 | 每小时 | ⏳ 待设置 |
| 数据备份 | 每天 | ⏳ 待设置 |
| 日志归档 | 每天 | ⏳ 待设置 |
| 磁盘检查 | 每天 | ⏳ 待设置 |
| 安全检查 | 每周 | ⏳ 待设置 |
| 性能优化 | 每月 | ⏳ 待设置 |
| 全面报告 | 每月 | ⏳ 待设置 |

---

## 当前服务状态

✅ 服务器运行中
- 进程ID: 337405
- 端口: 8080
- API健康: 正常
- 数据文件: 存在
- 日志文件: 正常

---

## 紧急联系方式

- **WhatsApp通知:** +5511996909894
- **本地日志:** /tmp/game-server.log
- **备份数据:** /root/myopencode/games/backups/

---

## 需要设置的任务

1. ⏳ 配置每小时健康检查（cron job）
2. ⏳ 配置每日数据备份（cron job + shell script）
3. ⏳ 配置日志自动归档（cron job）
4. ⏳ 配置磁盘空间告警
5. ⏳ 设置API频率限制
6. ⏳ 配置自动重启监控

---

## 监控和告警方式

**自动监控：**
- 通过cron定时任务检查服务状态
- 发现问题时自动处理或通知

**告警方式：**
- WhatsApp消息通知
- 日志记录
- 邮件通知（可选）

---

## 运维权限

**我可以执行的操作：**
- ✅ 查看/分析日志
- ✅ 重启服务
- ✅ 备份/恢复数据
- ✅ 更新代码
- ✅ 创建维护脚本
- ✅ 监控服务状态
- ✅ 调整配置

**需要你授权的操作：**
- ⚠️ 删除数据
- ⚠️ 更改安全组配置
- ⚠️ 重要系统配置
- ⚠️ 升级系统/Node.js

---

## 总结

我完全可以帮你运维这个游戏网站！我可以：

✅ **监控服务**：24/7自动监控，出现问题立即处理
✅ **数据备份**：每日自动备份，防止数据丢失
✅ **日志管理**：自动归档，定期清理
✅ **故障处理**：快速响应，自动恢复
✅ **性能优化**：定期检查，持续优化
✅ **安全维护**：定期安全检查和更新
✅ **报告统计**：定期发送运维报告

**需要我帮你设置的自动化任务有哪些？**

1. ⏰ 每小时健康检查
2. 💾 每日数据备份
3. 📝 日志自动归档
4. 🚨 磁盘空间告警
5. 🔄 自动重启监控

---

*创建时间：2026-02-09*
*运维负责人：Tom the AI cat 🐱*
